# 自用tools

该目录下是开发者自用的工具，用于调试或者自用的其他功能。

这份说明是为了避免开发者自己忘了怎么用而写的，请不要太在意这个目录下的所有内容。

暂且使用字母序来排列各节，请按需取用。

## `ass2srt_batch.py`

该脚本用于批量将 `.ass` 字幕文件转换为 `.srt` 格式，适用于字幕清洗或格式标准化需求。

### 用法

```sh
python ass2srt_batch.py --input <输入字幕目录> [--output <输出目录>]
```

**参数说明**
- `--input` : 包含 `.ass` 文件的输入目录（必填）。
- `--output` : 输出目录（选填），默认为当前目录下的 `tmp-srt`。

### 功能说明
1. 遍历输入目录下所有 `.ass` 文件。
2. 使用 `pysubs2` 加载并转换为 `.srt` 格式。
3. 输出为相同文件名的 `.srt` 文件至指定输出目录。

### 注意事项
- 依赖 `pysubs2` 库，请确保已安装：
  ```sh
  pip install pysubs2
  ```
- 输出目录若不存在将自动创建。
- 每个转换结果会在终端打印。

## `click_srt2ass.py`

该脚本用于将 `.srt` 字幕文件批量转换为 `.ass` 格式，并保存在当前目录下的 `ass/` 子目录中。

适用于将清洗过的 SRT 字幕重新转为 ASS 格式，用于回填视频或进行样式调整。

### 用法

拖至相应目录下，双击运行。

**参数说明**
- 无需额外参数，自动处理当前目录下所有 `.srt` 文件。

### 功能说明
1. 遍历当前目录下所有 `.srt` 文件。
2. 将每个 `.srt` 文件转换为 ASS 格式，自动添加字幕样式。
3. 输出的 `.ass` 文件将保存在当前目录的 `ass/` 子目录中。

### 注意事项
- 输出目录 `ass/` 若不存在将自动创建。
- 转换中将对花括号 `{}` 进行全角替换，避免和 ASS 特殊语法冲突。
- 输出字幕使用默认的 BottomCenter 样式，可根据需要手动调整样式定义。

## `ffmpeg_crop_batch.py`

该脚本用于批量裁剪指定目录下的 `.mp4` 视频文件。

裁剪区域为当前接收的他人录屏的固定参数：从顶部偏移 60px 开始，高度为 2340px，宽度为 1080px，用于去除上黑边。**可以直接修改代码里调用命令的部分来更改成需要的参数**

### 用法

```sh
python ffmpeg_crop_batch.py --input <输入视频目录> --output <输出视频目录>
```

**参数说明**
- `--input` : 包含要处理 `.mp4` 文件的视频目录（必填）。
- `--output` : 输出目录，用于保存裁剪后的视频（必填）。

### 功能说明
1. 遍历输入目录下所有 `.mp4` 文件。
2. 使用 `ffmpeg` 命令裁剪视频画面，保留中间区域。
3. 将处理后的视频保存至输出目录，文件名不变。

### 注意事项
- 依赖本地安装 `ffmpeg` 工具。
- 输出目录若不存在会自动创建。
- 输出文件将覆盖重名文件，请谨慎操作。

## `generate_long_pics.py`

该脚本用于将多个图片合并成长图，并可选地生成 PDF 文件。适用于将 `slides` 目录下的图片内容拼接成长条形图像，方便阅读或归档。

### 用法

```sh
python generate_long_pics.py --slides <图片文件夹路径> [--size 4] [--pdf]
```

**参数说明**
- `--slides` : 输入的图片文件夹路径（必填）。
- `--size`   : 每组合并的图片数量，默认为 4，可根据需要调整。
- `--pdf`    : 是否生成 PDF 文件，添加该参数时会输出 PDF。

### 处理逻辑
1. 读取 `--slides` 目录下的所有图片，并按编号排序。
2. 以 `--size` 为单位，将图片拼接成长图，并保存至 `slides-long` 目录。
3. 若指定 `--pdf` 选项，则将生成的长图合并为 PDF 文件。

### 注意事项
- 依赖 `PIL` (Pillow) 进行图像处理和 `fpdf` 进行 PDF 生成，请确保已安装：
  ```sh
  pip install pillow fpdf
  ```
- 输出的长图文件存放在 `slides-long/` 目录，PDF 文件名为 `slides-long.pdf`。
- 默认每 4 张图片拼接为一张长图，可通过 `--size` 参数修改。
- 若 `--pdf` 选项启用，则会将长图合并为单一 PDF 文件。

## `merge_srt.py`

该脚本用于将多个视频对应的字幕文件（SRT）合并为一个整体字幕文件，并自动调整时间轴以保证连续播放时字幕正确对应。

### 用法

```sh
python merge_srt.py [-yrb <路径前缀>]
```

**参数说明**
- `-yrb` 或 `--yml-relative-base`：可选参数，指定 `merge.yaml` 中路径的相对基准目录。若未指定，则以脚本所在目录为基准。

`merge_srt.yml` 文件的示例：

```yaml
- video_paths:
  - 01.mp4
  - 02.mp4
  - 03.mp4
- srt_paths:
  - 01.srt
  - 02.srt
  - 03.srt
```

### 功能说明
1. 读取脚本同级目录下的 `merge_srt.yml` 文件，获取视频文件路径和对应的字幕文件路径。
2. 遍历所有字幕文件，根据每个视频的时长自动偏移字幕时间轴，使其适配拼接后的视频。
3. 合并所有字幕为一个新的 `merged.srt` 文件，保证编号连续、时间轴准确。
4. 输出合并结果路径，并打印每个视频的编码信息（包括视频与音频编码、分辨率、帧率、采样率等）。

### 注意事项
- 依赖：
  ```sh
  pip install moviepy ffmpeg-python pyyaml
  ```
- `merge.yaml` 文件必须为如下格式，包含 `video_paths` 与 `srt_paths` 两个字段，且数量一致：
  ```yaml
  - video_paths:
      - path/to/video1.mp4
      - path/to/video2.mp4
  - srt_paths:
      - path/to/sub1.srt
      - path/to/sub2.srt
  ```
- 合并后的字幕输出为 `merged.srt`，位于当前工作目录或 `-yrb` 指定的目录下。

## `replace.py`
该脚本用于根据同级目录下的 `replace.yml` 文件对文本文件中的特定词语进行批量替换。

适用于标准化术语、清洗翻译文本、批量文本修改等需求。

### 用法

```sh
python replace.py --input <待处理文本文件路径>
```

**参数说明**
- `--input` : 需要进行替换处理的文本文件路径（必填）。

### 功能说明
1. 自动加载与脚本同目录下的 `replace.yml` 配置文件。
2. 读取指定的输入文本文件内容。
3. 根据配置中定义的替换对（键值对形式）对文本进行逐项替换。
4. 将替换后的内容保存为一个新文件，命名为 `<原文件名>-new.<扩展名>`。

### `replace.yml` 示例格式

```yaml
旧词1: 新词1
旧词2: 新词2
```

### 注意事项
- 替换配置文件必须命名为 `replace.yml`，并放置于脚本同目录下。
- 所有替换操作为全字面量匹配，区分大小写。
- 输出文件与原始文件在同一目录，文件名自动添加 `-new` 后缀。

## `srt2ass_batch.py`

该脚本用于批量将 `.srt` 字幕文件转换为 `.ass` 格式，并输出至 `ass/` 子目录。

适用于将标准 `.srt` 字幕转换为带样式的 `.ass` 字幕文件，方便视频回填或样式调整。

### 用法

```sh
python srt2ass_batch.py <输入字幕目录>
```

**参数说明**
- `<输入字幕目录>`：包含 `.srt` 文件的目录路径（必填）。

### 功能说明
1. 遍历输入目录下所有 `.srt` 文件。
2. 将每个字幕文件内容转换为 ASS 格式，使用默认样式（如 BottomCenter）。
3. 输出 `.ass` 文件至输入目录下的 `ass/` 子目录，文件名保持一致，仅后缀更改。

### 注意事项
- 转换使用内建的 ASS 样式模板，适配多种字幕位置（如 TopLeft、BottomCenter 等）。
- 字幕文本中的 `{}` 花括号会自动替换为全角字符，避免冲突。
- 输出目录若不存在会自动创建。
- 每条转换结果会在终端打印，例如 `Converted: input.srt -> ass/input.ass`。

## `test_paddle.py`

这是为了测试 PaddleOCR 实际能力所写的脚本。

该脚本使用 PaddleOCR 进行日语文本识别。适用于对单张图片中的日语文本进行 OCR.

### 用法

```sh
python test_paddle.py <图片路径>
```

**参数说明**
- `<图片路径>` : 要进行 OCR 识别的图片文件路径（必填）。

### 处理逻辑
1. 读取输入图片。
2. 使用 PaddleOCR 进行文本检测和识别，语言设定为日语（japan）。
3. 输出识别结果，包括文本内容和置信度。

### 注意事项
- 依赖 `paddleocr` 进行 OCR 识别，请确保其已安装：
  ```sh
  pip install paddleocr
  ```
- 识别效果可能受图片质量影响，建议使用清晰的高分辨率图片。
- 目前仅支持日语文本识别，其他语言请自行调整 `lang` 参数。

